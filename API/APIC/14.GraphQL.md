API Connect for GraphQL

IBM API Connect and API Connect Essentials (StepZen)

StepZen es la solución donde entra GraphQL, y ahora es API Connect Essentials. API Connect Essentials facilita a los desarrolladores la creación de APIs GraphQL. API Connect Essentials adopta un enfoque de programación declarativa (describe QUÉ hace el programa, sin especificar explícitamente CÓMO), lo que resulta en un código más compacto e intuitivo, un mejor rendimiento en tiempo de ejecución y una rentabilidad más rápida. StepZen también se diseñó para ofrecer una gran flexibilidad. Es compatible con otros enfoques de API y está disponible como servicio (SaaS), además de ser compatible con implementaciones en nubes privadas y centros de datos locales.

Configurando el ambiente
=

El primer paso para poder hacer uso de API Connect Essentials, es obtener un trial como hemos hecho con API Connect y con Instana en su momento. Para ello, deben ingresar en https://www.ibm.com/products/api-connect/api-development y seguir los pasos para solicitar su ambiente.

El ambiente que vamos a trabajar a continuacion, hace uso del ambiente API Connect que ya hemos estado trabajando en este Workshop.

Para el Workhsop con GraphQL, vamos a estar necesitando NodeJS en la maquina que estemos utilizando. PAra instalar Node JS, conectarse a la pagina oficial https://nodejs.org/en y seguir el proceso de instalacion, dependiendo del OS que esten utilizando. En mi caso, este seria el resultado luego de desplegar en Mac OS.

<img width="622" height="452" alt="image" src="https://github.com/user-attachments/assets/90e985f5-832f-448d-9e57-ee938081c49e" />

Luego, debemos si aun no lo tenemos; instalar Visual Code de Microsoft https://code.visualstudio.com/Download 

Una vez instalado Visual Code, ejecuten una nueva ventana de terminal en Visual para corroborar que Node es accedido.

```
node -v
```

<img width="1033" height="970" alt="image" src="https://github.com/user-attachments/assets/033f1539-4131-413a-bff3-07dcd470248c" />

Punto final de la preparacion, es instalar las herramientas clientes de StepZen. Desde la terminal abierta en Visual Code, ejecutar la siguiente linea.

```
npm install -g stepzen
```

Conexion a API Connect Essentials 
=

Para conectarse a API Connect Essentials basta con obtener los datos necesario para hacer un login con el siguiente comando

```
login [your_domain] -a [your_environment]
```

Los valores del dominio y entorno, se obtienen de la pantalla principal de API Connect Essentials cuando presionan el boton Login

<img width="1771" height="780" alt="image" src="https://github.com/user-attachments/assets/f36fbf97-0e59-4e8e-8ffb-bbc259544263" />

<img width="1769" height="1034" alt="image" src="https://github.com/user-attachments/assets/3281453e-fe21-4033-9d1a-e43b563183e2" />

Luego deberan proveer Admin Key para poder acceder a la plataforma.

Una vez que hayan podido ingresar, vamos a crear en el terminal de Visual Code un directorio. 

```
mkdir product-demo
cd product-demo
```

Inicializar el entorno de API Connect Essentials
=

Para inicializar el ambiente, debemos ejecutar la siguiente linea

```
stepzen init --endpoint=api/product-demo
```

Obtener la definicion de la API "Clientes"
=

Una funcion que provee la plataforma, se llama retrospection. Ahora nos conectaremos a una API y obtendremos su definicion en GraphQL.

```
stepzen import curl "https://introspection.apis.stepzen.com/customers" --query-name "customers"
```

Una vez importado, podemos visualizar el contenido creado en Visual Code

Debemos "abrir" la carpeta donde estamos trabajando, aceptar que el contenido es seguro.

<img width="1009" height="692" alt="image" src="https://github.com/user-attachments/assets/8a4f928c-95be-4867-9839-629436d95095" />

Luego, ir a curl y debajo elegir el archivo generado index.graphql

<img width="1409" height="671" alt="image" src="https://github.com/user-attachments/assets/1b64baeb-075b-4c15-bbbc-1aca4850ef77" />


Obtener la definicion de la API "Ordenes"
=

Ingresar el siguiente comando, para obtener la definicion de la API Ordenes

```
stepzen import curl "https://introspection.apis.stepzen.com/orders" --query-name "orders" --query-type "Order"
```

Podemos explorar el esquema, viendo el curl01

<img width="1207" height="670" alt="image" src="https://github.com/user-attachments/assets/f803009f-8955-41a6-a220-4367f329eb49" />

Podemos ver la documentacion que se esta obteniendo donde se pueden ver ambos esquemas

<img width="1207" height="670" alt="image" src="https://github.com/user-attachments/assets/fc2dde06-5805-4a7d-ba95-8e050469b941" />


Inicializar el endpoint
=

En el terminal de Visual Code, ejecutar la linea de comando siguiente

```
stepzen start
```

Desde la interfaz grafica de API Connect Essentials, ir a Endpoint y seleccionar los tres puntos para abrir el Explorador

<img width="1767" height="758" alt="image" src="https://github.com/user-attachments/assets/4aaba115-4b72-4cb7-8b5b-73123bb1b179" />

Presionar el Ejecutar, para ver la respuesta

<img width="1767" height="1106" alt="image" src="https://github.com/user-attachments/assets/24f5ded0-651c-4bd2-b2d5-74d4f1c90bca" />

Como se puede observar la respuesta, es la union de dos APIS... una de clientes y otra de ordenes.


Generar conexion a una base SQL Server
=



El primer paso sera conectarnos al motor de base de datos de nuestra aplicacion. Actualmente, estamos solo aceptando conexiones de direcciones y usuarios "conocidos". Para hacer un poco mas sencilla la actividad, vamos a definir que la base de datos acepte a un usuario en particular desde cualquier direccion IP. En este caso, vamos a solo dar permiso de realizar un SELECT con el usuario graphql. 

```
CREATE USER 'graphql'@'%' IDENTIFIED BY 'PASSw0rd2019!';
GRANT SELECT ON clientes_db.* TO 'graphql'@'%';
FLUSH PRIVILEGES;
```

Una vez generado los permisos, desde la consola de VS Code ejecutar la siguiente linea (recuerden modificar la direccion IP del servidor mySQL

```
stepzen import mysql --db-host='150.240.2.210:8080' --db-database='clientes_db' --db-user='graphql' --db-password='PASSw0rd2019!' --name=mysql
```

Una vez ejecutada esta linea, vamos a poder observar lo importado en VS Code

<img width="1777" height="969" alt="image" src="https://github.com/user-attachments/assets/dd10b4a2-5bef-45e4-9c4f-285adc59d9aa" />

Seleccionando el index.graphql de mysql podemos observar los campos obtenidos como querys de ejemplo

<img width="1777" height="969" alt="image" src="https://github.com/user-attachments/assets/38f296f6-9502-4243-8799-0bd0b8fbd5c4" />







