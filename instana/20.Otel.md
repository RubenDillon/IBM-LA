OpenTelemetry app demostration
=

Deploy the application
-

Usaremos la aplicacion de ejemplo de la comunidad en Open Telemetry. Para ello, necesitamos un cluster de Kubernetes y un ambiente de Instana.


En nuestro ejemplo, utilizaremos un Openshift... 

```
brew install openshift-cli
brew install kubectl
brew install helm

```

Conectarse a OpenShift desde linea de comando (suponemos que la API de OpenShift se encuentra publicada en https://api.itz-lfjm1n.infra01-lb.wdc07.techzone.ibm.com:6443) 

```

oc login --web  https://api.itz-lfjm1n.infra01-lb.wdc07.techzone.ibm.com:6443
kubectl get nodes

```


Creamos un archivo my.yaml para poner las variables de OpenTelemetry para que "hable" con el Agente de Instana 
```
opentelemetry-collector:
  config:
    exporters:
      otlp/instana:
        endpoint: http://instana-agent.instana-agent:4317
        tls:
          insecure: true

    service:
      pipelines:
        traces:
          exporters: [spanmetrics, otlp/instana]
```


Luego desplegamos la app utilizando estos parametros

```
helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts

helm install my-otel-demo open-telemetry/opentelemetry-demo --values my.yaml

```

Para poder acceder a la app, debemos crear una ruta en OpenShift...

```
  oc get svc frontend-proxy -n default
  oc expose svc/frontend-proxy --name=frontend-route --port=8080 -n default
  oc get route frontend-route -n default

```

Una vez la app esta funcionando... Instalamos el agente de Instana con el Operador de OpenShift (ver el siguiente ejemplo que debe incluir plugin.opentelemetry)

Ponemos como parametros (como ejemplo y lo que abajo van a encontrar)
- RHOS-otel como nombre de cluster
- otel como nombre de zona de Instana donde el cluster se va a alojar

```
apiVersion: instana.io/v1
kind: InstanaAgent
metadata:
  name: instana-agent
  namespace: instana-agent
spec:
  zone:
    name: otel # (optional) name of the zone of the host
  cluster:
      name: RHOS-otel
  agent:
    key: L2bLP7eoRWOOSm83MU1Z5A
    downloadKey: L2bLP7eoRWOOSm83MU1Z5A
    endpointHost: ingress-pumpkin-saas.instana.io
    endpointPort: "443"
    env: {}
    configuration_yaml: |
      # You can leave this empty, or use this to configure your instana agent.
      # See https://docs.instana.io/setup_and_manage/host_agent/on/kubernetes/
      com.instana.plugin.opentelemetry:
        grpc:
          enabled: true
        # port: 4317
        http:
          enabled: true
        # port: 4318
```


Vemos en Instana All Services en Application perspective

<img width="1542" height="852" alt="image" src="https://github.com/user-attachments/assets/cef4dc4f-e6a5-44dc-ba88-4ef2751f1f49" />

Si vemos una traza, podemos obtener informacion sobre versiones del framework que se utiliza, etc...

<img width="1717" height="871" alt="image" src="https://github.com/user-attachments/assets/f46c4f65-e581-470d-8ba9-e5417cded67e" />

Creamos una Perspectiva de App

<img width="1717" height="871" alt="image" src="https://github.com/user-attachments/assets/a9ec6f45-42f8-4e39-8b05-50297a83a0ec" />

<img width="1717" height="871" alt="image" src="https://github.com/user-attachments/assets/d867d7a9-1e52-4918-844c-5e86d261c306" />

<img width="1717" height="871" alt="image" src="https://github.com/user-attachments/assets/2ad3762f-f595-43c2-a22f-b410d0489864" />

<img width="1717" height="871" alt="image" src="https://github.com/user-attachments/assets/5e735066-8051-4493-938a-484ea5c1f724" />

Seleccionamos Analizar Trazas

<img width="1717" height="871" alt="image" src="https://github.com/user-attachments/assets/488c91ae-f4ce-410e-b068-e8363e1fd8f6" />

Podemos elegir cualquiera al azahar y ver la procedencia de la traza

<img width="1717" height="871" alt="image" src="https://github.com/user-attachments/assets/1830c190-0489-4f28-99ba-6a29928c815d" />










Documentacion utilizada
-



- https://ibm.github.io/waiops-tech-jam/labs/instana/opentelemetry/introduction/
- https://opentelemetry.io/docs/demo/kubernetes-deployment/
- https://community.ibm.com/community/user/blogs/ying-mo2/2025/04/06/monitoring-opentelemetry-demo-using-ibm-instana-a
- https://www.ibm.com/docs/en/instana-observability/1.0.301?topic=applications-instrumenting-opentelemetry-demo-instana
- https://www.ibm.com/docs/en/instana-observability/1.0.301?topic=instana-agent

