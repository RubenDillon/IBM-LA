Utilizacion de un Proxy para conexion de multiples agentes
=

El siguiente apartado trata la configuracion de un equipamiento con SQUID para que sea utilizado como proxy en una red local, para que los equipos con agentes de Instana no tengan conexion a internet directa.

Configuracion del Squid
-

Una vez instalado squid, se provee una configuracion standard del archivo squid.conf para Instana

```

# The tcp port squid is listening on
http_port 3128

# Please specify subnet with instana agents
acl instana_agent_net src 10.0.0.0/8

# This is the ip of the instana backend
acl instana_backend dstdomain saas-eu-west-1.instana.io
#acl instana_backend dstdomain ec2-54-144-114-141.compute-1.amazonaws.com
#acl instana_backend dstdomain saas-us-east-1.instana.io
#acl instana_backend dstdomain saas-us-east-1.instana.io

# This is the port used by Instana
acl instana_backend_port port 443

# This is the repo to download updates and additional sensors
acl instana_repo dstdomain artifact-public.instana.io
acl instana_repo_port port 80
acl instana_repo_port_secure port 443

# Protocol used for instana backend
acl instana_backend_proto proto HTTP

# Protocol used for instana backend
acl instana_repo_proto proto HTTP
acl instana_repo_proto_secure proto HTTPS

http_access allow instana_agent_net instana_backend instana_backend_port
http_access allow instana_agent_net instana_repo instana_repo_port
http_access allow instana_agent_net instana_repo instana_repo_port_secure

# DO NOT REMOVE THIS RULE!
http_access deny all

```


Configuracion en el agente
-

En cada servidor debe modificarse el archivo *instanaAgentDir*/etc/mvn-settings.xml y debemos contemplar la informacion del proxy. 

Suponemos que el servidor se llama squid.ibm.com y dejamos el puerto por defecto de la configuracion previa (3128)

```
  <!-- If you want to access the Instana repository using an HTTP/Socks proxy,
       uncomment the proxies section and insert proxy details. -->
  <!-- https://maven.apache.org/guides/mini/guide-proxies.html -->
  <!--
  <proxies>
    <proxy>
      <id>agent-proxy</id>
      <active>true</active>
      <protocol>http</protocol>
      <username></username>
      <password></password>
      <host>squid.ibm.com</host>
      <port>3128</port>
    </proxy>
  </proxies>
  -->

```

A su vez, se debe especificar en el archivo *instanaAgentDir*/etc/instana/com.instana.agent.main.sender.Backend.cfg la siguiente configuracion

```

proxy.type=http
proxy.host=squid.ibm.com
proxy.port=3128
#proxy.user=user-if-needed
#proxy.password=password-if-needed
proxy.dns=true

```


Documentacion utilizada

- https://www.ibm.com/docs/en/instana-observability/1.0.302?topic=agents-configuring-host#setting-up-an-agent-proxy
- 
